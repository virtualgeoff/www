<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Particles</title>
	<meta name="description" content="a cloud of particles in motion.">
	<meta name="keywords" content="particles, orbit">
	<meta name="author" content="virtualgeoff">
	<meta name="created" content="2022-12-03">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>

		html, body {margin:0; padding:0;}
		body {width:100vw; height:100vh; font-family:sans-serif; color:#090; background:#000; overflow:hidden;}
		#canvas {display:block;}

		body > p {position:absolute; top:0; width:20vw; margin:0; padding:1em; color:#0c0; z-index:99;}
		#info1 {left:0;    text-align:left;}
		#info2 {left:40vw; text-align:center;}
		#info3 {right:0;   text-align:right;}

	</style>
	<script>

		/* jshint esversion: 6 */

		function particles() {
			let canvas, ctx, origin = {}, radius, W, H;
			let info1, info2, info3;
			let previousTimeStamp, deltaT;

			const points = [];
			const N = 2500; // number of points
			const tau = 2 * Math.PI;

			function init() {
				// info
				info1 = document.querySelector('#info1');
				info2 = document.querySelector('#info2');
				info3 = document.querySelector('#info3');

				// get canvas element
				canvas = document.querySelector('canvas');
				ctx = canvas.getContext('2d');
				setSize();

				// start with non-zero number of points
				for (let i=0; i<N/20; i++) {
					points.push( makePoint() );
				}
			}

			function makePoint() {
				let v = Math.random() * 15 + 10; // velocity magnitude
				let θ = (Math.random() * 30 + 75) * tau/360 ; // angle: 75° to 105°

				let point = {
					x:  0,
					y:  0,
					vx: v * Math.cos(θ),
					vy: v * Math.sin(θ),
					ax: 0,
					ay: -0.5,
					r:  Math.round(Math.random() * 5) + 1,
					c: `hsl(${(Math.random() * 360)}, ${(Math.random() * 50 + 50)}%, ${Math.random() * 60 + 20}%)`
				};
				return point;
			}

			function setSize() {
				// get canvas size and origin
				canvas.width = W = window.innerWidth;
				canvas.height = H = window.innerHeight;
				origin.x = W/2;
				origin.y = H;
				radius  = Math.max(canvas.width, canvas.height) / 2;
				info3.innerText = `${W} × ${H} px`;
			}

			function draw(timestamp) {
				let p, r, f;
				ctx.clearRect(0, 0, canvas.width, canvas.height);

				// create some new points each loop (and/or retire some old ones)
				for (let i=0; i<3; i++) {
					if (points.length >= N) {
						points.shift();
					}
					points.push( makePoint() );
				}

				// draw all the points
				for (let i=0; i<points.length; i++) {
					p = points[i];
					// calculate acceleration, velocity, position
					p.vx += p.ax;
					p.vy += p.ay;
					p.x  += p.vx;
					p.y  += p.vy;

					// if a point goes out of frame, remove it and make a new one
					if (p.y < 0) {
						points.splice(i, 1);
						points.push( makePoint() );
					}

					// draw the point
					ctx.fillStyle = p.c;
					ctx.beginPath();
					ctx.ellipse(origin.x + p.x, origin.y - p.y, p.r, p.r, 0, 0, tau);
					ctx.fill();
				}

				// update data
				if (previousTimeStamp) {
					deltaT = timestamp - previousTimeStamp;
					info1.innerText = `n: ${points.length}\nΔt: ${deltaT} ms`;
				}
				previousTimeStamp = timestamp;

				// repeat
				requestAnimationFrame(draw);
			}

			init();
			draw();
			window.addEventListener('resize', setSize);
		}

		document.addEventListener('DOMContentLoaded', particles);

	</script>
</head>
<body>

	<canvas></canvas>

	<p id="info1">data</p>
	<p id="info2"></p>
	<p id="info3"></p>

</body>
</html>
