<!DOCTYPE html>
<html>
<head>
	<title>Spread</title>
	<style type="text/css">
	
		body, html {margin:0; padding:0;}
		
	</style>
	<script>

		// derived from http://tomtheisen.com/spread/

		var width;
		var height;
		var delay = 30;
		var startradius = 20;
		var straighten_factor = 0.95;
		var curviness = 0.2;
		var color_speed = 0.03;
		var new_branch_frames = 50;
		var branch_shrink = 0.95;
		var branch_opacity = 0.4;
		var max_branches = 7;
		var paper;
		var branches = [];
		var direction_offset = 0;
		var frame = 0;
		var fade = true;
		var cycle = true;
		var randomize = true;
		var wrap = true;

		function paperClick(event) {
			createTree(event.pageX - paper.canvas.offsetLeft, event.pageY - paper.canvas.offsetTop);
		}

		function createTree(x, y) {
			var n = Math.round(Math.random() * (max_branches-3)) + 3; // 3 - max_branches
			for (var i=0; i<n; i++) {
				//branches.push(new Branch(x, y, 0, startradius));
				branches.push(new Branch(x, y, (Math.PI * 2 * i/n), startradius));
			}
		}

		function Branch(x, y, direction, radius) {
			this.x = x;
			this.y = y;
			this.radius = radius;
			this.original_radius = radius;
			this.direction = direction;
		}

		function tick() {
			if (fade) {
				paper.fillRect(0,0,width,height);
			}

			if (cycle) {
				r = Math.floor(Math.sin(frame * color_speed) * 128 + 128)
				g = Math.floor(Math.sin(frame * color_speed + Math.PI * 2 / 3) * 128 + 128)
				b = Math.floor(Math.sin(frame * color_speed + Math.PI * 4 / 3) * 128 + 128)
				paper.strokeStyle = "rgba(" + r + "," + g + "," + b + ", " + branch_opacity + ")";
			}

			if(++frame % new_branch_frames == 0) {
				if (randomize) {
					x = (Math.random() + 0.1) * width * 0.8;
					y = (Math.random() + 0.1) * height * 0.8
					createTree(x, y);
				} else {
					createTree(width / 2, height / 2);
				}
			}

			direction_offset += Math.random() * curviness - curviness / 2;
			direction_offset *= straighten_factor;

			for (var i = branches.length - 1; i >= 0; i--) {
				var branch = branches[i];

				paper.beginPath();
				paper.lineWidth = branch.radius;
				paper.moveTo(branch.x, branch.y);

				branch.radius *= branch_shrink;
				branch.direction += direction_offset;
				branch.x += Math.cos(branch.direction) * branch.radius;
				branch.y += Math.sin(branch.direction) * branch.radius;

				paper.lineTo(branch.x, branch.y);
				paper.stroke();

				if (wrap) {
					if (branch.x > width) branch.x -= width;
					if (branch.x < 0) branch.x += width;
					if (branch.y > height) branch.y -= height;
					if (branch.y < 0) branch.y += height;
				}

				if (branch.radius < branch.original_radius / 2) {
					branches.splice(i, 1);
					var new_radius = branch.original_radius / 2;
					if (new_radius > 1) {
						branches.push(new Branch(branch.x, branch.y, branch.direction - 0.5, new_radius));
						branches.push(new Branch(branch.x, branch.y, branch.direction + 0.5, new_radius));
					}
				}
			}
		}

		function setup() {
			// get window size
			width = window.innerWidth;
			height = window.innerHeight;

			// create canvas element
			canvas = document.createElement("canvas");
			canvas.width = width;
			canvas.height = height;
			document.body.appendChild(canvas);

			// draw frame
			paper = canvas.getContext("2d");
			paper.fillStyle = "rgb(0,0, 0)";
			paper.fillRect(0,0,width,height);
			paper.fillStyle = "rgba(0,0, 0, 0.005)";
			paper.strokeStyle = "rgba(128,128,64," + branch_opacity + ")";
			canvas.onclick = paperClick;

			setInterval(tick, delay);
		}

		window.onload = setup;

	</script>
</head>
<body>
</body>
</html>
